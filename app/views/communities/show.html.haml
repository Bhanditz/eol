%h1{:id => 'community_name'}= h @community.name
%p{:id => 'community_description'}= h @community.description
.roles
  - roles = @community.roles
  - if roles.blank?
    %p{:id => 'community_roles_empty'}= "There are currently no roles for this community."[]
  - else
    = render :partial => 'roles/index', :locals => {:roles => roles}
- i_am_in_this_community = current_user.member_of?(@community)
- member_function = i_am_in_this_community ? 'member allowed' : 'member not_allowed'
- non_member_function = i_am_in_this_community ? 'non_member not_allowed' : 'non_member allowed'
.members
  - if @members.blank?
    %p{:id => 'community_members_empty'}= "There are currently no members in this community."[]
  - else
    = render :partial => 'members/index', :locals => {:i_am_in_this_community => i_am_in_this_community, :member_function => member_function, :non_member_function => non_member_function }
.actions
  - if @member
    = "You must be"[]
    = link_to("logged in"[], login_path)
    = "to join communities."[]
  - else
    %ul{:id => 'community_actions'}
      - if @current_member
        %li{:id => 'leave_community', :class => member_function}
          %form{ :method => 'post', :action => member_path(@current_member.id) }
            %input{ :type => :hidden, :name => '_method', :value => 'delete' }
            %input{ :type => :hidden, :name => 'member[id]', :value => @current_member.id }
            %input{ :type => :submit, :name => 'submit', :value => 'Leave community' }
          = ajax_spinner
        - if @current_member.can?(Privilege.edit_delete_community)
          %li{:id => 'edit_community', :class => member_function}
            = link_to("Edit this community"[:edit_community], edit_community_path(@community))
          %li{:id => 'delete_community', :class => member_function}
            = link_to("Delete this community"[:delete_community], community_path(@community), :confirm => "Are you sure?"[], :method => :delete)
      - else
        %li{:id => 'join_community', :class => non_member_function}
          %form{ :method => "post", :action => "/members" }
            %input{ :type => :hidden, :name => "community[id]", :value => @community.id }
            %input{ :type => :submit, :name => 'submit', :value => 'Join community' }
          = ajax_spinner
.focus
  %h3= "Taxa"[]
  - if @community.focus.nil?
    = "This community has no focus list."[]
  - elsif @community.focus.collection_items.empty?
    = "This community has no focus items associated with it."[]
  - else
    = render :partial => "/collections/show", :locals => { :collection => @community.focus }
= render :partial => 'feed_items/index', :locals => {:feed => @community.feed}
