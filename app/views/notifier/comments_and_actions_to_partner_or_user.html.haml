- type_to_send_permalinks_for = [DataType.image.id, DataType.text.id] + DataType.video_type_ids

- if @agent_or_user.class == AgentContact
  = "Dear #{@agent_or_user.full_name} on behalf of #{@agent_or_user.agent.full_name},"
- else
  = "Dear #{@agent_or_user.full_name},"
= ""

- if @agent_or_user.class == AgentContact  # the contact for a content partner
  You are receiving this message because you are listed as a contact for an Encyclopedia of Life content partner.
  For more detailed information, log in to your account in the EOL Content Partner Registry:
  = url_for(:controller => 'content_partner', :action => 'login', :only_path => false, :host => $SITE_DOMAIN_OR_IP);
  = ""
  Then go to USAGE REPORTS:
  = url_for(:controller => 'content_partner', :action => 'reports', :only_path => false, :host => $SITE_DOMAIN_OR_IP);
  = ""
  To turn off or change how often you receive these updates, log in to your account in the EOL Content Partner Registry and edit your profile (CONTACT INFORMATION:Change):
  = url_for(:controller => 'content_partner', :action => 'edit_contact', :id => @agent_or_user.id, :only_path => false, :host => $SITE_DOMAIN_OR_IP);
  = ""
  If you have trouble accessing your account please contact us for help:
  = url_for(:controller => 'contact_us', :default_subject => 'Content Partner Support', :only_path => false, :host => $SITE_DOMAIN_OR_IP);
- else  # a site user that has submitted content
  To turn off or change how often you receive these updates, log in to EOL and go to your profile:
  = url_for(:controller => 'profile', :only_path => false, :host => $SITE_DOMAIN_OR_IP);
  = ""
  If you have trouble accessing your account please contact us for help:
  = url_for(:controller => 'contact_us', :default_subject => 'Technical problems (difficulties with the website, search tool or user accounts)', :only_path => false, :host => $SITE_DOMAIN_OR_IP);
= ""
= ""


-# Curator actions
- unless @activity.blank? || @activity[:actions].blank?
  ======================================
  - if @activity[:actions].length > 1
    Curator actions have affected data objects you submitted:
  - else
    A curator action has affected a data object you submitted:
  ======================================
  - for action in @activity[:actions]
    - data_object = action.data_object
    - taxon_concept = TaxonConcept.find(data_object.linked_taxon_concept.id)  # so we get superceded concepts
    - date = format_date_time(action.created_at,:format=>'short_no_tz')
    - url = nil
    - if type_to_send_permalinks_for.include?(data_object.data_type_id)
      - url = url_for(:controller => 'data_objects', :action => data_object.id, :only_path => false, :host => $SITE_DOMAIN_OR_IP)
    = "  #{date}"
    = "    #{taxon_concept.entry.name.string}"
    - if url
      = "    #{url}"
    = "    #{action.action_with_object.action_code} by #{action['curator_username']}"
    = "  -----"
    = ""
  = ""

-# Comments on their objects
- unless @activity.blank? || @activity[:object_comments].blank?
  ======================================
  - if @activity[:object_comments].length > 1
    Comments were left on data objects you submitted:
  - else
    A comment was left on a data object you submitted:
  ======================================
  - for comment in @activity[:object_comments]
    - data_object = comment.parent
    - taxon_concept = TaxonConcept.find(data_object.linked_taxon_concept.id)  # so we get superceded concepts
    - date = format_date_time(comment.created_at,:format=>'short_no_tz')
    - url = nil
    - if type_to_send_permalinks_for.include?(data_object.data_type_id)
      - url = url_for(:controller => 'data_objects', :action => data_object.id, :only_path => false, :host => $SITE_DOMAIN_OR_IP)
    = "  #{date}"
    = "    #{taxon_concept.entry.name.string}"
    - if url
      = "    #{url}"
    = "    From user #{comment['commenter_username']}: #{comment.body.strip}"
    = "  -----"
    = ""
  = ""

-# Comments on pages their objects are on
- unless @activity.blank? || @activity[:page_comments].blank?
  ======================================
  - if @activity[:page_comments].length > 1
    Comments were left on the taxon page comments tab (may not apply specifically to your content):
  - else
    A comment was left on a taxon page comments tab (may not apply specifically to your content):
  ======================================
  - for comment in @activity[:page_comments]
    - taxon_concept = TaxonConcept.find(comment.parent_id)  # so we get superceded concepts
    - date = format_date_time(comment.created_at,:format=>'short_no_tz')
    - url = url_for(:controller => 'taxa', :action => 'show', :id => taxon_concept.id, :only_path => false, :host => $SITE_DOMAIN_OR_IP)
    = "  #{date}"
    = "    #{taxon_concept.entry.name.string}"
    = "    #{url}"
    = "    From user #{comment['commenter_username']}: #{comment.body.strip}"
    = "  --------"
    = ""
  = ""

= ""
Thank you.
= ""
= "Encyclopedia of Life"
