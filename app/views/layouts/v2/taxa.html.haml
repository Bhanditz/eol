- content_for :main do
  = render :partial => 'taxa/classification_selector' unless @selected_hierarchy_entry.blank?
  #page_heading.with_nav
    .site_column
      .hgroup
        %h1
          - if @selected_hierarchy_entry
            = hh(@taxon_concept.quick_scientific_name(:italicized, @selected_hierarchy_entry.hierarchy))
          - else
            %i= hh(@taxon_concept.title_canonical())

          %span.assistive<
            = " &mdash; #{@assistive_section_header}"

        - preferred_common_name = @selected_hierarchy_entry ? @selected_hierarchy_entry.taxon_concept.subtitle(@selected_hierarchy_entry.hierarchy) : @taxon_concept.subtitle()

        %h2{:title => I18n.t(:preferred_common_name_advisory_information)}
          = hh(preferred_common_name) unless preferred_common_name.blank?
          - common_name_count = @selected_hierarchy_entry ? @taxon_concept.common_names(:hierarchy_entry_id => @selected_hierarchy_entry.id).count : @taxon_concept.common_names.count

          - if common_name_count > 0
            - if @selected_hierarchy_entry
              - link_url = taxon_hierarchy_entry_names_path(@taxon_concept, @selected_hierarchy_entry.id)
            - else
              - link_url = taxon_names_path(@taxon_concept)
            %small= link_to I18n.t(:learn_more_about_names_for_this_taxon), link_url, { :title => I18n.t(:common_names_advisory_information) }

      .page_actions
        %ul
          %li
            = render :partial => 'shared/add_to_my_collection', :locals => { :item => @taxon_concept, :my_collection => @watch_collection }
          - if current_page?(:controller => 'taxa/details', :action => 'index')
            %li= link_to I18n.t(:add_article_to_page_link_button), new_taxon_data_object_path(@taxon_concept), :class => 'button'
          - if @selected_hierarchy_entry
            %li= link_to I18n.t(:show_data_from_all_content_partners), taxon_overview_path(@taxon_concept)

      = render :partial => 'shared/flash_messages'

      %ul.nav
        -# NOTE the "if" and, below, the "else". If you're having trouble, you may have edited one and not the other!
        - if @selected_hierarchy_entry
          %li{:class => resource_is_active('taxa/overviews')}= link_to I18n.t(:overview), taxon_hierarchy_entry_overview_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/details')}= link_to I18n.t(:detail), taxon_hierarchy_entry_details_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/media')}= link_to I18n.t(:media_with_count, :count => @taxon_concept.media_count(@selected_hierarchy_entry)), taxon_hierarchy_entry_media_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/maps')}= link_to I18n.t(:maps_with_count, :count => @taxon_concept.has_map ? 1 : 0), taxon_hierarchy_entry_maps_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/names')}= link_to I18n.t(:names), taxon_hierarchy_entry_names_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/communities')}= link_to I18n.t(:community), taxon_community_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/resources')}= link_to I18n.t(:resources), taxon_resources_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/literature')}= link_to I18n.t(:literature), taxon_hierarchy_entry_literature_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/updates')}= link_to I18n.t(:updates), taxon_hierarchy_entry_updates_path(@taxon_concept, @selected_hierarchy_entry)
          %li{:class => resource_is_active('taxa/worklist')}= link_to I18n.t(:worklist), taxon_worklist_path(@taxon_concept) if current_user.is_curator?
        - else
          -# NOTE the two blocks, above and below, here.  Lots of duplication.  Change both, due to subtle diffs.
          %li{:class => resource_is_active('taxa/overviews')}= link_to I18n.t(:overview), taxon_overview_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/details')}= link_to I18n.t(:detail), taxon_details_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/media')}= link_to I18n.t(:media_with_count, :count => @taxon_concept.media_count), taxon_media_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/maps')}= link_to I18n.t(:maps_with_count, :count => @taxon_concept.has_map ? 1 : 0), taxon_maps_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/names')}= link_to I18n.t(:names), taxon_names_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/communities')}= link_to I18n.t(:community), taxon_community_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/resources')}= link_to I18n.t(:resources), taxon_resources_path(@taxon_concept)
          %li{:class => resource_is_active('taxa/literature')}= link_to I18n.t(:literature), taxon_literature_path(@taxon_concept.id)
          %li{:class => resource_is_active('taxa/updates')}= link_to I18n.t(:updates), taxon_updates_path(@taxon_concept.id)
          %li{:class => resource_is_active('taxa/worklist')}= link_to I18n.t(:worklist), taxon_worklist_path(@taxon_concept) if current_user.is_curator?

  #content
    .site_column
      = yield

= render :file => 'layouts/v2/application'
