= javascript_include_tag 'admin-curator' # TODO - handle JS more elegantly.
Click a username to view the user's detailed profile.  You may change the clade level curator permissions on the user profile pages.  If credentials are truncated, click to expand and show full credentials.
= link_to '[export all curators as CSV]',:action=>'export'
#users
  - form_tag({:action=>'index'},:id=>'search',:method=>'get') do
    Search for curators containing:
    = text_field_tag(:user_search_string,@user_search_string)
    %br
    = check_box_tag 'only_unapproved','1',@only_unapproved
    Only show unapproved curators |
    = check_box_tag 'only_without_clade','1',@only_without_clade
    Only show curators with no clade selected
    = submit_tag 'Go'
    %br
    %br
  - if @users.nil? == false && @users.size > 0
    A total of
    = @user_count
    users were found matching your criteria.
    %br
    %form
      = will_paginate @users
    %table.results_table{ :cellspacing => "0" }
      %tr
        %th
          UserName
        %th
          Credentials
        %th
          Name
        %th
          Clade
        %th
          Approved?
        %th
          Remove
        %th
          On
        %th
          By
      - for user in @users
        - column_class=cycle('odd','even')
        %tr{ :id => "row_#{user.id}" }
          %td{ :class => column_class }
            = link_to(user.username, :controller => 'administrator/user', :action=>'edit',:id=>user.id)
            - if user.curator_approved
              %br
              %small
                (
                = link_to('curator profile', :controller => '/account', :action => :show, :id => user.id)
                )
          %td{ :class => column_class }
            .toggle-credentials.linky
              = truncate(h(user.credentials))
            %div{ :style => "display:none;" }
              = allow_some_html(user.credentials)
          %td{ :class => column_class }
            = h user.full_name
          %td{ :class => column_class }
            = user.curator_hierarchy_entry.name unless user.curator_hierarchy_entry.blank?
          - form_id = "user_curator_#{user.id}"
          %td{ :class => column_class }
            - if !user.curator_hierarchy_entry.blank?
              - form_tag('/administrator/user/toggle_curator', :id => form_id, :method => 'get') do
                %input{ :name => "id", :type => "hidden", :value => user.id }
                = check_box_tag('curator_approved', user.curator_approved, user.curator_approved)
            - else
              N/A
          %td{ :class => column_class }
            = link_to 'remove', {:controller => 'administrator/user', :action => :clear_curatorship, :id => user.id}, {:class => :remove_link}
          %td{ :class => column_class, :id => "#{form_id}_at" }
            = format_date_time(user.curator_verdict_at) unless user.curator_verdict_at.nil?
          %td{ :class => column_class, :id => "#{form_id}_by" }
            = link_to(user.curator_verdict_by.username,:action=>'edit',:id=>user.id) unless user.curator_verdict_by.nil?
    %br
    %form
      = will_paginate @users
  - else
    No users are available matching your search criteria.
:javascript
  $('.toggle-credentials').toggle(
    function() { $(this).next().slideDown(); },
    function() { $(this).next().slideUp(); }
  );
