<%- if !results.blank? -%>
  <div class="search_results" id="<%= title.downcase.underscore %>">    
    <h3 class="search_result_subtitle"><%="#{title}"[]%></h3>
    <p> Results <%= results.offset + 1 %> - <%= results.offset + [results.per_page, results.total_entries].min %> of <%= results.total_entries %> for <em><%= @querystring %></em></p>
              
    <table class="results_table" cellspacing="0" summary="<%= title %>" style="width:100%;">
      <tr>
        <th style="width:152px;"><%="Image"[]%></th>
        <th style="width:50%;"><%="Common Name"[]%></th>
        <th style="width:50%;"><%="Scientific Name"[]%></th>
      </tr>
      <% for result in results
         tc_id = result['taxon_concept_id'][0]
         common_name = result['best_matched_common_name'] 
      %>
      result["preferred_common_name"] = <%= debug (result["preferred_common_name"]) %>
      result["best_matched_common_name"] = <%= debug (result["best_matched_common_name"]) %>
      <%   if (result["best_matched_common_name"].blank? or result["preferred_common_name"].blank? or result["preferred_common_name"].downcase == result['best_matched_common_name'].downcase)
          shown_name = '' 
         else "shown as '#{result['preferred_common_name']}'"
         end
         scientific_name = result['title']
         vetted_value = ''
         vetted_value = '_unvetted' if result['vetted_id'][0].to_i == Vetted.find_by_label('Unknown').id
         vetted_value = '_untrusted' if result['vetted_id'][0].to_i == Vetted.find_by_label('Untrusted').id

         top_image = result['top_image_id'] ? DataObject.find(result['top_image_id']) : nil rescue nil
         column_class = cycle('odd' + vetted_value, 'even' + vetted_value)
      %>
        <tr>
          <td class="<%= column_class %>"><% unless top_image.nil? %>
            <a href="<%= url_for(:action => 'search_clicked', :id => tc_id) %>"><img
              alt="<%= strip_tags(scientific_name) %>" title="<%= strip_tags(scientific_name) %>" src="<%= top_image.smart_medium_thumb %>"/></a>
          <%end%></td>
          <td class="<%= column_class %>"><%= link_to common_name,
                                                      {:action => 'search_clicked', :id => tc_id},
                                                      :method=>:post %><br /><%= shown_name %>
                                                      </td>
          <td class="<%= column_class %>"><%= link_to scientific_name,
                                                      {:action => 'search_clicked', :id => tc_id},
                                                      :method=>:post %><br /></td>          
        </tr>
      <% end %>
    </table>    

    <%= will_paginate(results) %>

  </div> <%# /search_results %>
  <br />
<%- end -%>
