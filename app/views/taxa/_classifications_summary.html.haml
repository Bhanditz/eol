- if @selected_hierarchy_entry
  = render(:partial => 'taxa/classification_tree')
- else
  - if preferred_classification = @taxon_concept.curator_chosen_classification
    #classification_tree.article
      - hierarchy_entry = preferred_classification.hierarchy_entry
      .header
        %h3= I18n.t(:classification_summary_section_header)
      .meta.curated
        = I18n.t(:classification_from_agent_chosen_by_curator, :agent => hierarchy_display_title(hierarchy_entry.hierarchy), :curator => link_to(preferred_classification.user.full_name, user_path(preferred_classification.user_id)))
      #classification_browser.browsable.classifications
        %ul
          = render(:partial => 'taxa/trees/show', :locals => {:in_hierarchy => true, :hierarchy_entry => hierarchy_entry, :link_to_taxa => true, :show_siblings => true})
  - else
    #classifications_summary.article.browsable.classifications
      - count = @browsable_hierarchy_entries.length
      .header
        %h3= I18n.t(:classifications_summary_header_with_count, :count => count)
        - if count > 1
          - if @selected_hierarchy_entry
            = link_to(I18n.t(:see_all_classifications_with_count_html, :count => count), taxon_hierarchy_entry_names_path(@taxon_concept, @selected_hierarchy_entry))
          - else
            = link_to(I18n.t(:see_all_classifications_with_count_html, :count => count), taxon_names_path(@taxon_concept))
      - if count > 0
        %ul
          - @browsable_hierarchy_entries.shuffle[0..1].each do |hierarchy_entry|
            %li
              - hierarchy_label = hierarchy_display_title(hierarchy_entry.hierarchy)
              %h4= I18n.t(:rank_recognized_by_agent_colon, :rank => hierarchy_entry.rank_label, :agent => hierarchy_label)
              %ul
                - if hierarchy_entry.has_parent?
                  %li
                    = link_to  hierarchy_entry.parent.italicized_name.firstcap, taxon_hierarchy_entry_overview_path(hierarchy_entry.parent.taxon_concept_id, hierarchy_entry.parent.id)
                    %ul.branch
                      = render(:partial => 'taxa/classifications_summary_minitree_node_with_children', :locals => {:hierarchy_entry => hierarchy_entry})
                - else # No ancestor, start with this node:
                  = render(:partial => 'taxa/classifications_summary_minitree_node_with_children', :locals => {:hierarchy_entry => hierarchy_entry})
      - else
        .empty
          %p= I18n.t(:classifications_empty)
