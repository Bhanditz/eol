function lookup_concept(e){lookup_id(e,"/concept_manager/lookup_concept/")}function lookup_entry(e){lookup_id(e,"/concept_manager/lookup_entry/")}function lookup_id(e,t){var n=$(e);$.ajax({url:t+n.val(),beforeSend:function(e){n.siblings(".entries").html('<p style="text-align: center;"><img src="/assets/green_loader.gif"/></p>')},success:function(e){n.siblings(".entries").html(e),n.siblings(".entries").attr("taxon_concept_id",$(this).attr("id")),add_drag_events_to_selector(n)},error:function(e){n.siblings(".entries").html("lookup failed")}})}function supercede_concepts(e,t){$.ajax({url:"/concept_manager/supercede_concepts?id1="+e+"&id2="+t,beforeSend:function(e){$("#left_panel .entries, #right_panel .entries").html('<p style="text-align: center;"><img src="/assets/green_loader.gif"/></p>')},success:function(n){$("#right_panel .entries").html("");var r=e;t<e&&(r=t),$("#tc1").val(r),lookup_concept("#tc1"),alert("Concepts were successfully merged")},error:function(e){$("#right_panel .entries").html(""),$("#left_panel .entries").html("something went wrong")}})}function split_entry(e){$.ajax({url:"/concept_manager/split_entry_from_concept/"+e,beforeSend:function(e){$("#left_panel .entries, #right_panel .entries").html('<p style="text-align: center;"><img src="/assets/green_loader.gif"/></p>')},success:function(e){$("#right_panel .entries").html("");var t=e;$("#tc1").val(t),lookup_concept("#tc1"),alert("Concepts were successfully merged")},error:function(e){$("#right_panel .entries").html(""),$("#left_panel .entries").html("something went wrong")}})}function add_drag_events_to_selector(e){e.siblings(".entries").children(".entry_details").hover(function(){$(this).addClass("entry_hover")},function(){$(this).removeClass("entry_hover")}).draggable({opacity:.5,revert:!0,start:function(e,t){dragged_div=$(this),$(this).css("z-index",9)}}).mouseup(function(e,t){if(typeof dragged_div=="undefined")return;if(dragged_div==null)return;previously_dragged_div=dragged_div,dragged_div.css("z-index",10),dragged_div=null,dropped_div=$(".entry_hover");if(typeof dropped_div=="undefined"){alert("fail");return}dropped_div.attr("hierarchy_entry_id")==previously_dragged_div.attr("hierarchy_entry_id")?alert("Cannot drop - same concept"):dropped_div.attr("taxon_concept_id")==previously_dragged_div.attr("taxon_concept_id")?alert("Cannot drop - same concept"):alert("Dropping "+previously_dragged_div.attr("hierarchy_entry_id")+" to "+dropped_div.attr("hierarchy_entry_id"))})}dragged_div=null,$(document).ready(function(){$("#tc1 + input").click(function(){lookup_concept("#tc1")}),$("#he1 + input").click(function(){lookup_entry("#he1")}),$("#tc2 + input").click(function(){lookup_concept("#tc2")}),$("#he2 + input").click(function(){lookup_entry("#he2")}),$("#merge_concepts").hover(function(){$(this).addClass("entry_hover")},function(){$(this).removeClass("entry_hover")}).click(function(){var e=$("#left_panel .entry_details").length,t=$("#right_panel .entry_details").length;if(e==0||t==0){alert("You can only merge two concepts");return}var n=$("#left_panel .entry_details:first").attr("taxon_concept_id"),r=$("#right_panel .entry_details:first").attr("taxon_concept_id");if(n==r){alert("Cannot merge: these concepts are the same");return}supercede_concepts(n,r)}),$("#split_concepts").hover(function(){$(this).addClass("entry_hover")},function(){$(this).removeClass("entry_hover")}).mouseup(function(e,t){if(typeof dragged_div=="undefined"){alert("fail1");return}if(dragged_div==null){alert("fail2");return}previously_dragged_div=dragged_div,dragged_div.css("z-index",10),dragged_div=null,dropped_div=$(".entry_hover");if(typeof dropped_div=="undefined"){alert("fail");return}split_entry(previously_dragged_div.attr("hierarchy_entry_id"))})});