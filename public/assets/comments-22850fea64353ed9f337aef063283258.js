if(!EOL)var EOL={};EOL.handle_special_anchors_in_location_hash=function(){if(location.hash!=""){var e=location.hash.replace(/#/,"").replace(/\?.*$/,""),t=e.replace("reply-to-","");e==t?EOL.highlight_comment($("#"+e),!0):$("#"+t).find("li.reply a").click()}},EOL.highlight_comment=function(e,t){if($(e).size()==0)return!1;var n=$(e).offset().top;return $("li").removeClass("highlight"),e.closest("li").toggleClass("highlight"),t||$("html,body").animate({scrollTop:n},650),!1},EOL.reply_to=function(e){var t=e.attr("href"),n=EOL.jump_to_comment($("#"+t.replace(/^.*#reply-to-/,"")),t,!0);if(!n){var r=$("form#new_comment");r.size()==0?EOL.redirect_to_comment_source(t):($("html,body").animate({scrollTop:r.offset().top},650),EOL.add_reply_details(r,e),$("a#reply-cancel").click(function(e){e.preventDefault(),EOL.reset_reply_details(r)}),r.find("textarea").focus())}},EOL.reset_reply_details=function(e){var t=e.find(":submit");t.val(t.data("post")),t.parent().find("span").remove(),EOL.set_reply_fields(e,""),$("li").removeClass("highlight")},EOL.add_reply_details=function(e,t){var n=e.find(":submit");n.parent().find("span").remove(),n.data("post",n.val()).val(n.data("reply")),n.after('<span id="reply-to">@'+t.data("reply-to")+' &nbsp; <a id="reply-cancel" href="#">'+n.data("cancel")+"</a></span>"),EOL.set_reply_fields(e,t)},EOL.set_reply_fields=function(e,t){e.find("input#comment_reply_to_type").val(t?t.data("reply-to-type"):""),e.find("input#comment_reply_to_id").val(t?t.data("reply-to-id"):"")},EOL.follow_reply=function(e){var t=$(e).attr("href");EOL.jump_to_comment($(t),t,!1)},EOL.redirect_to_comment_source=function(e,t){window.location="/activity_logs/find/"+e.replace(/^.*-(\d+)$/,"$1")+"?"+$.param({type:e.replace(/^.*[#-]([^-]+)-\d+$/,"$1"),reply:t})},EOL.close_enough=function(e){var t=e.replace(/#.*$/,"").replace(/^.*\/\/[^\/]*\//,"").replace(/^\//,""),n=t.split("/"),r=location.pathname.replace(/^\/+/,"").split("/");return n[0]==r[0]&&n[1]==n[1]?!0:n[1]==r[1]&&n[2]==n[2]?!0:!1},EOL.jump_to_comment=function(e,t,n){return e.size()==0||n&&!EOL.close_enough(t)?(EOL.redirect_to_comment_source(t,n),!0):(EOL.highlight_comment(e,n),!1)},EOL.init_comment_behaviours=function(){var e=$("ul.feed"),t=e.find("blockquote a[href^=#]");t.unbind("click"),t.click(function(e){e.preventDefault(),EOL.follow_reply($(this))});var n=e.find("ul.actions li.reply a");n.unbind("click"),n.click(function(e){e.preventDefault(),EOL.reply_to($(this))});var r=e.find("ul.actions a.edit_comment");r.unbind("click"),r.click(function(e){e.preventDefault(),$(this).closest("ul.actions").hide();var t=$(this).closest(".editable").find("blockquote").hide().end().find(".details");t.after('<div class="comment_edit_form"></div>');var n=t.next(".comment_edit_form");return EOL.ajax_get($(this),{update:n,type:"GET"}),!1});var i=e.find(".comment_edit_form a");i.unbind("click"),i.click(function(e){e.preventDefault(),$(this).closest(".comment_edit_form").hide().closest("li").find("ul.actions").show().end().find("blockquote").show().end().end().remove()});var s=e.find(".comment_edit_form input[type='submit']");s.unbind("click"),s.click(function(e){return e.preventDefault(),EOL.ajax_submit($(this)),!1});var o=e.find("form.delete_comment input[type='submit']");o.unbind("click"),o.click(function(e){return e.preventDefault(),confirm($(this).data("confirmation"))&&EOL.ajax_submit($(this)),!1})},$(function(){EOL.init_comment_behaviours(),EOL.handle_special_anchors_in_location_hash(),$("ul.feed").ajaxSuccess(function(){EOL.init_comment_behaviours()})});