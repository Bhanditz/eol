$(function(){function e(e){parseInt(e.w)>0&&$("#crop_panel .crop_preview img").each(function(){var t=$(this).parent().width()/e.w,n=$(this).parent().width()/e.h;$(this).attr("src",o.attr("src")),$(this).css({width:Math.round(t*o.width())+"px",height:Math.round(n*o.height())+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(n*e.y)+"px",visibility:"visible"}).show()}),n(e)}function t(){$("#crop_panel .crop_preview img").each(function(){$(this).stop(),$(this).attr("style",""),$(this).attr("src",$(this).attr("original_src"))})}function n(e){s.children('[name="x"]').val(e.x),s.children('[name="y"]').val(e.y),s.children('[name="w"]').val(e.w),s.children('[name="h"]').val(e.h)}function i(){return parseInt(s.children('[name="w"]').val())>0?!0:(alert('Please select a crop region in the larger image, then press "crop image".'),!1)}var o=$("#permalink img:first"),s=$("#crop_form form");o.Jcrop({onChange:e,onSelect:e,onRelease:t,minSize:[50,50],addClass:"auto_margin",aspectRatio:1}),o.closest("a").on("click",function(e){e.preventDefault()}),s.submit(function(){return i()})});