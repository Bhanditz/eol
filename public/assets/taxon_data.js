function update_input_id_and_name(e,t){e.find("input").each(function(){$(this).attr("id",$(this).attr("id").replace(/\d+/,t)),$(this).attr("name",$(this).attr("name").replace(/\d+/,t)),$(this).attr("data-id-element")&&$(this).attr("data-id-element",$(this).attr("data-id-element").replace(/\d+/,t)),$(this).attr("data-include-predicate_known_uri_id")&&$(this).attr("data-include-predicate_known_uri_id",$(this).attr("data-include-predicate_known_uri_id").replace(/\d+/,t)),$(this).attr("data-update-elements")&&$(this).attr("data-update-elements",$(this).attr("data-update-elements").replace(/\d+/,t))})}if(!EOL)var EOL={};var _TOOLTIP_OPEN=!1;EOL.max_meta_rows=10,EOL.create_info_dialog=function(e){var t=$(e).closest("[id]"),n=t.attr("id");$(e).attr("id","info_"+n).before('<a id="tip_'+n+'" class="info_icon" data-info="'+n+'">&emsp;&emsp;&emsp;&emsp;</a>').addClass("tip").prepend('<a href="#" class="close">&nbsp;</a>'),EOL.enable_info_dialogs($("#tip_"+n)),$(e).appendTo(document.body)},EOL.enable_info_dialogs=function(e){e.on("click",function(){$(".site_column").unbind("click");var e=$(this),t=$("#info_"+$(this).attr("data-info"));if(t.is(":visible"))t.hide("fast");else{$(".info.tip").hide("fast");var n=$(this).offset();t.css({top:n.top+$(this).height()+26,left:n.left+$(this).width()}),t.show("fast",function(){$(".site_column").click(function(){$(".info").hide("fast"),$(".site_column").unbind("click")})}).find("a.close").on("click",function(){return $(".info").hide("fast"),!1})}})},EOL.enable_button=function(e){e.is(":disabled")&&e.removeAttr("disabled").fadeTo(225,1)},EOL.disable_button=function(e){e.is(":disabled")||e.attr("disabled",!0).fadeTo(225,.3)},EOL.attribute_is_not_okay=function(){$("input#user_added_data_predicate").addClass("problems"),$("#new_uri_warning").show(),EOL.disable_measurement_input()},EOL.attribute_is_okay=function(){$("input#user_added_data_predicate").removeClass("problems"),$("#new_uri_warning").hide(),$("#predicate_uri_type").val()=="measurement"&&$("#user_added_data_predicate").val()!=""?$("fieldset.unit_of_measure").fadeIn(100):EOL.disable_measurement_input()},EOL.disable_measurement_input=function(){$("fieldset.unit_of_measure").fadeOut(100),$("fieldset.unit_of_measure input").val("")},EOL.hide_data_tables=function(e){e.hide(),e.prev("div.header_underlined").hide()},EOL.show_data_tables=function(e){e.show(),e.prev("div.header_underlined").show(),e.find("tr.data").show(),e.find("tr.actions").hide(),$(".help_text").show()},EOL.toggle_actions_row=function(e){var t=e.find(".fold img"),n=e.next(),r=n.children("td"),i=e.next().find("table.meta");if(n.is(":visible"))t.attr("src","/assets/arrow_fold_right.png"),n.hide(),i.hide();else{var s=e.attr("id");e.data("loading")!=1&&e.data("loaded")!=1?(t.attr("src","/assets/indicator_arrows_black.gif"),e.data("loading",!0),$.ajax({url:"/data_point_uris/"+s.replace("data_point_","")+"/show_metadata",dataType:"html",success:function(e){var t=r.prepend(e);t.find(".info").each(function(){var e=$(this).find("ul.glossary > li").html(),t=$(this).find(".uri").text();EOL.create_info_dialog(this),$('.glossary_subtab ul.glossary:not(:contains("'+t+'"))').append("<li>"+e+"</li>")}),$(".glossary_subtab ul.glossary > li").sort(EOL.sort_glossary).appendTo(".glossary_subtab ul.glossary"),EOL.enable_hover_list_items()},error:function(e,t,r){n.html("<p>Sorry, there was an error: "+t+"</p>")},complete:function(){t.attr("src","/assets/arrow_fold_down.png"),n.show(),EOL.yank_glossary_terms(n),i.show(),e.data("loading",!1),e.data("loaded",!0),t.attr("src","/assets/arrow_fold_down.png")}})):e.data("loading")!=1&&(t.attr("src","/assets/arrow_fold_down.png"),n.show(),i.show())}},EOL.sort_glossary=function(e,t){return $(t).find("dt").text()<$(e).find("dt").text()?1:-1},EOL.enable_suggestions_hover=function(){$("input#user_added_data_predicate").parent().hover(function(){!$("ul.ui-autocomplete").is(":visible")&&$("input#user_added_data_predicate").val()==""?$("div#suggestions").show():$("div#suggestions").hide()},function(){$("div#suggestions").hide()})},EOL.disable_suggestions_hover=function(){$("input#user_added_data_predicate").parent().unbind("hover")},EOL.limit_data_rows=function(){$("table.data tr.more").remove(),$("table.data tr.data.first_of_type:visible").each(function(){var e=$(this).attr("data-type"),t=$(this).closest("table").find('tr[data-type="'+e+'"]:visible');if(t.length>EOL.max_meta_rows){var n=1;t.each(function(){n>EOL.max_meta_rows&&$(this).hide(),n++}),t.filter(":last").after('<tr data-type="'+e+'" class="data nested more"><th></th><td><a href="#" class="more">'+$("table.data").attr("data-more").replace("NNN",t.length-EOL.max_meta_rows)+"</a></td></tr>"),$("tr.more a.more").unbind("click").on("click",function(){var e=$(this).closest("tr");return $('tr.data[data-type="'+e.attr("data-type")+'"]').show(),e.remove(),!1})}})},EOL.yank_glossary_terms=function(e){},EOL.enable_hover_list_items=function(){$("ul.glossary li").hover(function(){$(this).find("li.hover").show()},function(){$(this).find("li.hover").hide()})},$(function(){$(".has_many").each(function(){var e=$(this).clone();e.find(".once").remove();var t=$(this).closest("form").find("input[id^=user_added_data_user_added_data_metadata_attributes]").filter(":last"),n=parseInt(t.attr("id").match(/(\d+)/)[1]);update_input_id_and_name(e,n+=1),e.appendTo($(this)).addClass("subform").hide(),$(this).append('<span class="add"><a href="#">'+$(this).attr("data-another")+"</a></span>"),$(this).find(".add a").on("click",function(){e.clone().insertBefore($(this).parent()).show(),update_input_id_and_name(e,n+=1);var t=$(".has_many_expandable").height();return $(".has_many_expandable").height(t+e.height()),!1})}),$("div#suggestions").appendTo($("input#user_added_data_predicate").parent()),$("input#user_added_data_predicate").keyup(function(e){var t=e.keyCode||e.which;if(t===13)return;var n=$(this);n.val()!=""&&$("div#suggestions").hide(),$("#user_added_data_predicate_known_uri_id").val()!=""&&($("#user_added_data_predicate_known_uri_id").val(""),EOL.attribute_is_not_okay()),n.val()==""||$("#user_added_data_predicate_known_uri_id").val()!=""?EOL.attribute_is_okay():EOL.attribute_is_not_okay()}).focus(function(){$(this).val()==""&&$("div#suggestions").show()}),EOL.enable_suggestions_hover(),$("fieldset.unit_of_measure").hide(),$("table.data .fold a").on("click",function(){return $(this).closest("tr").click(),!1}),$("table.data tr.actions").hide().prev().find(".fold img").attr("src","/assets/arrow_fold_right.png"),$("table.data tr.data").on("click",function(e){if($(e.target).closest("a").length)return;EOL.toggle_actions_row($(this))}),$("table.data tr.actions td .metadata").live("click",function(e){if($(e.target).closest("a").length)return;EOL.toggle_actions_row($(this).closest("tr").prev())}),$("#recently_used_category a").on("click",function(){$("#suggestions").find(".child").hide();var e=$(this).parent().next();while(e.hasClass("child"))e.show(),e=e.next();return!1}),$("li.attribute").live("click",function(){var e=$(this).find(".name");$("#user_added_data_predicate").val(e.text()),$("#user_added_data_predicate_known_uri_id").val(e.data("id")),$("#predicate_uri_type").val(e.data("uri_type")),$("#user_added_data_has_values").val(e.data("has_values")),EOL.attribute_is_okay(),$("div#suggestions").hide()}),$("#user_added_data_predicate").bind("railsAutocomplete.select",function(e,t){EOL.attribute_is_okay()}),$("input[data-autocomplete]").live("focus",function(){if($(this).data("autocomplete").match(/known_uri_values/)){var e=$(this).closest("div").find('input[id*="has_values"]:first');e.length>0&&(e.val()=="1"?$(this).autocomplete("enable"):$(this).autocomplete("disable"))}$(this).attr("id")=="user_added_data_predicate"?$(this).autocomplete("search",$(this).val()):$(this).autocomplete("search"," ")}),$("input[data-autocomplete]").keyup(function(e){var t=e.keyCode||e.which;if(t===37||t===38||t===39||t===40)return;$(this).val()==""&&($(this).attr("id")=="user_added_data_predicate"?$("div#suggestions").show():$(this).autocomplete("search"," "))}),$("#tabs_sidebar.data ul.subtabs a").on("click",function(){return $(".about_subtab").hide(),$(".glossary_subtab").hide(),$(this).parent().hasClass("about")?(EOL.hide_data_tables($("table.data")),$("#taxon_data .empty").hide(),$(".glossary_subtab").hide(),$(".help_text").hide(),$(".about_subtab").show()):$(this).parent().hasClass("glossary")?(EOL.hide_data_tables($("table.data")),$("#taxon_data .empty").hide(),$(".about_subtab").hide(),$(".help_text").hide(),$(".glossary_subtab").show()):$(this).hasClass("all")?($("#taxon_data .empty").show(),EOL.show_data_tables($("table.data"))):(EOL.hide_data_tables($("table.data")),EOL.show_data_tables($('table.data[data-toc_id="'+$(this).attr("data-toc-id")+'"]'))),$(this).parent().parent().find("li").removeClass("active"),$(this).parent().addClass("active"),$("table.data tr.open").removeClass("open"),$("table.data .fold img").attr("src","/assets/arrow_fold_right.png"),$("table.meta").hide(),EOL.limit_data_rows(),!1}),EOL.limit_data_rows();if(location.hash!=""){var e=location.hash.replace(/\?.*$/,""),t=$(e);t.click();if(t.offset()!==undefined){var n=t.offset().top-200;$("html, body").animate({scrollTop:n})}}$("#data_summary table").hover(function(){$("span.remove").show()},function(){$("span.remove").hide()}).find("span.remove").hide(),$("a.button.hidden").hide(),$("#sortable").sortable({placeholder:"placeholder",items:"tr:not(.headers)",helper:"clone",tolerance:"pointer",update:function(e,t){$.post("/known_uris/sort",{known_uris:$("#sortable").sortable("toArray"),moved_id:t.item.attr("id")})}}).disableSelection(),$("#sortable a.to_top").click(function(){return $.post("/known_uris/sort",{to:"top",moved_id:$(this).closest("tr").attr("id")}),!1}),$("#sortable a.to_bottom").click(function(){return $.post("/known_uris/sort",{to:"bottom",moved_id:$(this).closest("tr").attr("id")}),!1}),$("table.data tr .info, table.data.search tr .info").each(function(){EOL.create_info_dialog(this)}),$(".add_content .article").hide(),$(".add_content .add_data a").on("click",function(){var e=$(".add_content .article");return e.is(":visible")?($(this).removeClass("open"),$(".add_content .article").hide()):($(this).addClass("open"),$(".add_content .article").show()),!1}),EOL.enable_hover_list_items(),$(".page_actions .data_download a").click(function(){window.alert($(this).parent().attr("data-alert").replace(/<\/?[^>]+>/g,""))})});